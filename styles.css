const projects = []; // Will be populated dynamically
const projectsDirectoryUrl = './projects/'; // Adjust based on your directory structure

async function fetchProjectFiles() {
    try {
        const projectFileNames = ['project1.json', 'project2.json']; // Replace with actual file names
        for (const fileName of projectFileNames) {
            await fetchProjectData(`${projectsDirectoryUrl}${fileName}`);
        }
        populateProjects(projects);
    } catch (error) {
        console.error('Error fetching project files:', error);
    }
}

async function fetchProjectData(projectUrl) {
    try {
        const response = await fetch(projectUrl);
        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }
        const projectData = await response.json();
        projects.push(projectData);
    } catch (error) {
        console.error('Error fetching project data:', error);
    }
}

function populateProjects(projectsList) {
    const projectsListContainer = document.getElementById('projects-list');
    projectsListContainer.innerHTML = '';
    projectsList.forEach(project => {
        const projectEntry = document.createElement('div');
        projectEntry.classList.add('project-entry');
        projectEntry.innerHTML = `
            <img class="project-image" src="${project.image}" alt="${project.name}">
            <div class="project-details">
                <div class="project-title">${project.name}</div>
                <div class="project-description">${project.description.substring(0, 50)}...</div>
            </div>
        `;
        projectEntry.addEventListener('click', () => selectProject(project.id));
        projectsListContainer.appendChild(projectEntry);
    });
}

function selectProject(projectId) {
    const project = projects.find(p => p.id === projectId);
    const projectDescription = document.getElementById('project-description');
    const projectCodeExamples = document.getElementById('project-code-examples');
    projectDescription.textContent = project.description;
    projectCodeExamples.textContent = project.codeExample;
}

function scoreAndFilterProjects(searchTerm) {
    const words = searchTerm.toLowerCase().split(/\s+/);
    const scoredProjects = projects.map(project => {
        let score = 0;
        words.forEach(word => {
            if (project.name.toLowerCase().includes(word)) {
                score += 5;
            }
            if (project.description.toLowerCase().includes(word)) {
                score += 2;
            }
            if (project.tags && project.tags.some(tag => tag.toLowerCase().includes(word))) {
                score += 10;
            }
        });
        return { project, score };
    });
    return scoredProjects.filter(p => p.score > 0).sort((a, b) => b.score - a.score).map(p => p.project);
}

let searchTimeout;
document.getElementById('search-input').addEventListener('keyup', function() {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(() => {
        const searchTerm = this.value;
        const filteredAndScoredProjects = scoreAndFilterProjects(searchTerm);
        populateProjects(filteredAndScoredProjects);
    }, 500);
});

document.addEventListener('DOMContentLoaded', () => {
    fetchProjectFiles();
});

